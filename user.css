/*
 * ============================================================
 * MINIMAL 4-BAR VISUALIZER
 * ============================================================
 * A lightweight CSS-only visualizer with organic bar movement.
 *
 * Author: [Gugedo](https://github.com/Gugedo/spicetify-minimal-visualizer)
 * ============================================================
 */

:root {
    --viz-color: var(--spice-button-active); /* Matches seek bar color */
    --viz-speed: 0.8s;                      /* Slightly faster for better rhythm */
    --viz-width: 18px;                      /* Total width of the 4 bars */
    --viz-height: 20px;                     /* Total height area */
    --viz-bar-w: 3px;                       /* Fixed width of each bar */
    --viz-off-y: -4px;                      /* Vertical offset adjustment */
}

/* 1. VISUALIZER CORE */
.main-nowPlayingBar-extraControls::before {
    content: "";
    display: flex;
    width: var(--viz-width);
    height: var(--viz-height);
    margin-right: 15px;
    transform: translateY(var(--viz-off-y));
    
    /* We define 4 separate layers to allow independent movement */
    background-image: 
        linear-gradient(var(--viz-color), var(--viz-color)),
        linear-gradient(var(--viz-color), var(--viz-color)),
        linear-gradient(var(--viz-color), var(--viz-color)),
        linear-gradient(var(--viz-color), var(--viz-color));

    background-position: 0% 100%, 33% 100%, 66% 100%, 100% 100%;
    background-repeat: no-repeat;
    
    /* Initial animated sizes (width must be fixed to --viz-bar-w) */
    background-size: var(--viz-bar-w) 40%, var(--viz-bar-w) 80%, var(--viz-bar-w) 30%, var(--viz-bar-w) 60%;
    
    animation: organicBounce var(--viz-speed) infinite linear;
    transition: background-size 0.3s ease;
}

/* 2. ORGANIC ANIMATION
 * Each of the 4 values changes independently at every step
 * to mimic a real audio spectrum.
 */
@keyframes organicBounce {
    0%   { background-size: var(--viz-bar-w) 70%, var(--viz-bar-w) 100%, var(--viz-bar-w) 10%, var(--viz-bar-w) 40%; }
    9%  { background-size: var(--viz-bar-w) 85%, var(--viz-bar-w) 85%, var(--viz-bar-w) 25%, var(--viz-bar-w) 55%; }
    18%  { background-size: var(--viz-bar-w) 100%, var(--viz-bar-w) 70%, var(--viz-bar-w) 40%, var(--viz-bar-w) 70%; }
    27%  { background-size: var(--viz-bar-w) 85%, var(--viz-bar-w) 55%, var(--viz-bar-w) 55%, var(--viz-bar-w) 85%; }
    36%  { background-size: var(--viz-bar-w) 70%, var(--viz-bar-w) 40%, var(--viz-bar-w) 70%, var(--viz-bar-w) 100%; }
    45% { background-size: var(--viz-bar-w) 55%, var(--viz-bar-w) 25%, var(--viz-bar-w) 85%, var(--viz-bar-w) 85%; }
    54%   { background-size: var(--viz-bar-w) 40%, var(--viz-bar-w) 10%, var(--viz-bar-w) 100%, var(--viz-bar-w) 70%; }
    63%  { background-size: var(--viz-bar-w) 25%, var(--viz-bar-w) 25%, var(--viz-bar-w) 85%, var(--viz-bar-w) 55%; }
    72%  { background-size: var(--viz-bar-w) 10%, var(--viz-bar-w) 40%, var(--viz-bar-w) 70%, var(--viz-bar-w) 40%; }
    81%  { background-size: var(--viz-bar-w) 25%, var(--viz-bar-w) 55%, var(--viz-bar-w) 55%, var(--viz-bar-w) 25%; }
    90% { background-size: var(--viz-bar-w) 40%, var(--viz-bar-w) 70%, var(--viz-bar-w) 40%, var(--viz-bar-w) 10%; }
    100% { background-size: var(--viz-bar-w) 55%, var(--viz-bar-w) 85%, var(--viz-bar-w) 25%, var(--viz-bar-w) 25%; }
}

/* 3. STOP LOGIC
 * Targets the Play icon path to detect pause state.
 * Forces bars to 2px height while maintaining fixed 3px width (Prevents Square Glitch).
 */
.main-nowPlayingBar-container:has(
    button[data-testid="control-button-playpause"] path[d^="M3"], 
    button[data-testid="control-button-playpause"] path[d^="M11"],
    button[aria-label*="Play"]
) .main-nowPlayingBar-extraControls::before {
    background-size: var(--viz-bar-w) 2px, var(--viz-bar-w) 2px, var(--viz-bar-w) 2px, var(--viz-bar-w) 2px !important;
    animation: none !important;
    opacity: 0.8;
}